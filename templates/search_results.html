{% extends "base.html" %}

{% block title %}Search results{% end %}

{% block additional_styles %}
    <link href="{{ static_url('css/search.css') }}" rel="stylesheet">
{% end %}

{% block content %}
    <div ng-app="travel" ng-controller="searchResultsCtrl" id="app">
        <div class="row">
            <div class="col-md-2 col-sm-4 col-xs-12">
                <a href="{{ reverse_url('home') }}" class="btn btn-sm btn-default">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    Back to search
                </a>
            </div>
        </div>
        <div class="row">
            <div class="table-header main-table col-md-12"
                    data-url="{{ reverse_url('search-results-data', guid) }}"
                    ng-show="(records.length != 0 && done) || !done" ng-cloak>
                <div class="col-xs-3">From/To</div>
                <div class="col-xs-2">Transport types</div>
                <div class="col-xs-2 sort-col" ng-click="sort('transfers')">
                    <span class="sort-text">Transfers</span>
                    <span ng-show="sort_type == 'transfers' && !sort_reverse"
                          class="glyphicon glyphicon-chevron-up" ng-cloak></span>
                    <span ng-show="sort_type == 'transfers' && sort_reverse"
                          class="glyphicon glyphicon-chevron-down" ng-cloak></span>
                </div>
                <div class="col-xs-3 sort-col" ng-click="sort('duration_raw')">
                    <span class="sort-text">Duration</span>
                    <span ng-show="sort_type == 'duration_raw' && !sort_reverse"
                          class="glyphicon glyphicon-chevron-up" ng-cloak></span>
                    <span ng-show="sort_type == 'duration_raw' && sort_reverse"
                          class="glyphicon glyphicon-chevron-down" ng-cloak></span>
                </div>
                <div class="col-xs-2 sort-col" ng-click="sort('price_raw')">
                    <span class="sort-text">Price</span>
                    <span ng-show="sort_type == 'price_raw' && !sort_reverse"
                          class="glyphicon glyphicon-chevron-up" ng-cloak></span>
                    <span ng-show="sort_type == 'price_raw' && sort_reverse"
                          class="glyphicon glyphicon-chevron-down" ng-cloak></span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="table-row col-xs-12" ng-repeat="record in records | orderBy:sort_type:sort_reverse">
                <div class="row part-row">
                    <div class="col-xs-3">
                        <div class="row" ng-bind="record.from"></div>
                        <div class="row" ng-bind="record.to"></div>
                    </div>
                    <div class="col-xs-2">
                        <div class="center-cell oneline-cell">
                            <img class="type-icon" ng-repeat="tran in record.transport_types"
                                 ng-src="{{!tran.icon}}" title="{{!tran.name}}"/>
                        </div>
                    </div>
                    <div class="col-xs-2 center-cell oneline-cell" ng-bind="record.transfers"></div>
                    <div class="col-xs-3 center-cell oneline-cell" ng-bind="record.duration"></div>
                    <div class="col-xs-2 center-cell oneline-cell"
                        title="{{!record.price_lower + ' to ' + record.price_upper}}">
                        <div ng-bind="record.price" class="price-text"></div>
                        <span ng-show="record.has_price_range" class="glyphicon glyphicon-info-sign"
                              style="margin-top:4px;"></span>
                    </div>
                </div>
                <div class="row part-row">
                    <div class="col-xs-12 col-segs">
                        <span class="details" ng-click="record.show_details = !record.show_details">
                            <span ng-cloak ng-hide="record.show_details">show</span><span ng-cloak ng-show="record.show_details">hide</span>
                            details<span ng-cloak ng-hide="record.show_details">▾</span><span ng-cloak ng-show="record.show_details">▴</span>
                        </span>
                        <div ng-cloak ng-show="record.show_details" class="segments">
                            <div class="row lower-part">
                                <div class="small-name col-xs-2 center-cell point-name" ng-bind="record.from"></div>
                            </div>
                            <div ng-repeat="segment in record.segments">
                                <div class="row segment-row">
                                    <div class="col-xs-2 center-cell">
                                        <img class="type-icon" ng-src="{{!segment.transport_type.icon}}"
                                             title="{{!segment.transport_type.name}}"/>
                                    </div>
                                    <div ng-switch="segment.segment_type">
                                        <div ng-switch-when="surface">
                                            <div class="col-xs-3 center-cell med-text" ng-bind="segment.frequency">
                                            </div>
                                            <div class="col-xs-2 center-cell med-text">
                                                <a href="{{!segment.schedule_url}}" title="{{!segment.schedule_name}}" ng-show="segment.schedule_name" style="display:block;">Schedule</a>
                                                <a href="{{!segment.book_url}}" title="{{!segment.book_name}}" ng-show="segment.book_name" style="display:block;">Booking</a>
                                            </div>

                                        </div>
                                        <div ng-switch-when="air">
                                            <div class="col-xs-3 center-cell med-text">
                                                <span class="small-name">Departure:</span>
                                                <span ng-bind="segment.time_start"></span>
                                                <span class="airport">
                                                    (<span ng-bind="segment.airport_start_code"
                                                          title="{{!segment.airport_start_name}}">
                                                    </span>)
                                                </span>
                                                <br/>
                                                <span class="small-name">Arrival:</span>
                                                <span ng-bind="segment.time_end"></span>
                                                <span class="airport">
                                                    (<span ng-bind="segment.airport_end_code"
                                                          title="{{!segment.airport_end_name}}">
                                                    </span>)
                                                </span>
                                            </div>
                                            <div class="col-xs-2 center-cell med-text">
                                                <div ng-switch="segment.days">
                                                    <div ng-switch-when="Every day">
                                                        <span ng-bind="segment.days"></span>
                                                    </div>
                                                    <div ng-switch-default>
                                                        <div title="{{!segment.days}}">
                                                            Certain days
                                                            <span ng-show="record.has_price_range" class="glyphicon glyphicon-info-sign"
                                                                  style="margin-top:6px;"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-3 center-cell med-text" ng-bind="segment.duration">
                                    </div>
                                    <div class="col-xs-2 center-cell med-text">
                                        <div title="{{!segment.price_lower + ' to ' + segment.price_upper}}">
                                            <div ng-bind="segment.price" class="price-text"></div>
                                            <span ng-show="segment.has_price_range"
                                                  class="glyphicon glyphicon-info-sign"
                                                  style="margin-top:4px;"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="small-name col-xs-2 center-cell point-name"
                                         title="{{!segment.to_full}}">{{!segment.to}}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="text-align: center; margin-bottom: 10px; margin-top: 10px; font-size: 16px; font-weight: bold;" ng-cloak ng-show="!done">
                Loading...
            </div>
            <div style="text-align: center; margin-bottom: 10px; margin-top: 10px; font-size: 16px; font-weight: bold;" ng-cloak ng-hide="(records.length != 0 && done) || !done">
                Unfortunately, no results found that match your request
            </div>
        </div>
    </div>
{% end %}

{% block additional_js %}
    <script src="{{ static_url('js/search.js') }}"></script>
{% end %}